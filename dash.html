<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>CRM –î–∞—à–±–æ—Ä–¥</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px 12px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #eee;
      text-align: left;
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      background: #007bff;
      color: #fff;
      font-size: 12px;
      margin-left: 5px;
    }
  </style>
</head>
<body>

  <h1>CRM –î–∞—à–±–æ—Ä–¥</h1>

  <div class="card" id="summary">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
  <div class="card" id="temperature"></div>
  <div class="card" id="interactions"></div>

  <script>
    const baseUrl = "https://nashcrm.onrender.com/api/crm/dashboard/";
    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzUzNDYwNjI5LCJpYXQiOjE3NTA4Njg2MjksImp0aSI6IjhlODY3YWRjNTQwODRmNjA5NmU2ZTcyYzI3MzU5YmJkIiwidXNlcl9pZCI6MX0.mmpdox80nFOQs-uJdw-x0JPxIXGpI48A3oqm1bwhSxE"; // üî• –≤—Å—Ç–∞–≤ —Ç–æ–∫–µ–Ω

    fetch(baseUrl, {
      headers: {
        "Authorization": "Token " + token
      }
    })
    .then(res => {
      if (!res.ok) throw new Error("API error: " + res.status);
      return res.json();
    })
    .then(data => {
      renderSummary(data.summary);
      renderTemperature(data.temperature_breakdown);
      renderInteractions(data.recent_interactions);
    })
    .catch(err => {
      document.getElementById("summary").innerHTML = `<span style="color:red;">–ü–æ–º–∏–ª–∫–∞: ${err.message}</span>`;
    });

    function renderSummary(summary) {
      document.getElementById('summary').innerHTML = `
        <h2>–ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>
        <p>–ö–ª—ñ—î–Ω—Ç—ñ–≤: ${summary.total_clients}</p>
        <p>–ê–ö–ë –∫–ª—ñ—î–Ω—Ç—ñ–≤: ${summary.akb_clients}</p>
        <p>–ì–∞—Ä—è—á—ñ –ª—ñ–¥–∏: ${summary.hot_leads}</p>
        <p>–†–∏–∑–∏–∫ –≤—Ç—Ä–∞—Ç–∏: ${summary.churn_risk}</p>
        <p>–í–∏—Ä—É—á–∫–∞: ${summary.total_revenue.toFixed(2)} –≥—Ä–Ω</p>
        <p>–°–µ—Ä–µ–¥–Ω—ñ–π LTV: ${summary.avg_ltv.toFixed(2)}</p>
        <p>–¢–µ—Ä–º—ñ–Ω–æ–≤–∏—Ö –∑–∞–¥–∞—á: <span class="badge">${summary.urgent_tasks}</span></p>
      `;
    }

    function renderTemperature(temp) {
      document.getElementById('temperature').innerHTML = `
        <h2>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ª—ñ–¥—ñ–≤</h2>
        <ul>
          <li>‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ñ: ${temp.cold}</li>
          <li>üå§Ô∏è –¢–µ–ø–ª—ñ: ${temp.warm}</li>
          <li>üî• –ì–∞—Ä—è—á—ñ: ${temp.hot}</li>
          <li>üò¥ –°–ø–ª—è—á—ñ: ${temp.sleeping}</li>
        </ul>
      `;
    }

    function renderInteractions(interactions) {
      const el = document.getElementById('interactions');
      if (!interactions.length) {
        el.innerHTML = "<h2>–í–∑–∞—î–º–æ–¥—ñ—ó</h2><p>–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤</p>";
        return;
      }

      el.innerHTML = `
        <h2>–û—Å—Ç–∞–Ω–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó</h2>
        <table>
          <thead>
            <tr>
              <th>–î–∞—Ç–∞</th>
              <th>–ö–ª—ñ—î–Ω—Ç</th>
              <th>–¢–∏–ø</th>
              <th>–¢–µ–º–∞</th>
              <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
            </tr>
          </thead>
          <tbody>
            ${interactions.map(i => `
              <tr>
                <td>${new Date(i.created_at).toLocaleString()}</td>
                <td>${i.client_name}</td>
                <td>${i.type}</td>
                <td>${i.subject}</td>
                <td>${i.outcome}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }
  </script>

</body>
</html>
