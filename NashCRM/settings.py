"""
Django settings for NashCRM project.

Generated by 'django-admin startproject' using Django 5.2.3.

üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–û –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ CRM —Å–∏—Å—Ç–µ–º–∏
–í–∫–ª—é—á–∞—î –∫–µ—à—É–≤–∞–Ω–Ω—è, —ñ–Ω–¥–µ–∫—Å–∏, –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –±–µ–∑–ø–µ–∫—É
"""
import os
from pathlib import Path
from django.templatetags.static import static
from django.urls import reverse_lazy
from django.utils.translation import gettext_lazy as _
from datetime import timedelta

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-q^cstj+vp83u^gqy_864z5um7sviic5=bfnl%esn6p4-jzk^3='

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = [
    'nashcrm.onrender.com',
    'localhost',
    '127.0.0.1',
]

# üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø REST FRAMEWORK
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ),
    # üöÄ –î–û–î–ê–ù–û: –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Å–ø–∏—Å–∫—ñ–≤
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 50,  # –û–±–º–µ–∂—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É

    # üöÄ –î–û–î–ê–ù–û: –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∏
    'DEFAULT_RENDERER_CLASSES': [
        'rest_framework.renderers.JSONRenderer',
    ],
    'DEFAULT_PARSER_CLASSES': [
        'rest_framework.parsers.JSONParser',
    ],

    # üöÄ –î–û–î–ê–ù–û: Throttling –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    'DEFAULT_THROTTLE_CLASSES': [
        'rest_framework.throttling.AnonRateThrottle',
        'rest_framework.throttling.UserRateThrottle'
    ],
    'DEFAULT_THROTTLE_RATES': {
        'anon': '100/hour',
        'user': '1000/hour',
        'reports': '60/hour',  # –û–±–º–µ–∂—É—î–º–æ –∑–≤—ñ—Ç–∏
    }
}

# Application definition
GOOGLE_MAPS_API_KEY = "AIzaSyCbJKRdLawZO1Y61MORHULsFbxGbQLlrsk"

ASGI_APPLICATION = "NashCRM.asgi.application"
CHANNEL_LAYERS = {
    "default": {
        "BACKEND": "channels.layers.InMemoryChannelLayer",
    }
}

# üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–Ü JWT –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø
SIMPLE_JWT = {
    "ACCESS_TOKEN_LIFETIME": timedelta(days=30),
    "REFRESH_TOKEN_LIFETIME": timedelta(days=60),
    "ROTATE_REFRESH_TOKENS": False,
    "BLACKLIST_AFTER_ROTATION": True,
    "AUTH_HEADER_TYPES": ("Bearer",),

    # üöÄ –î–û–î–ê–ù–û: –î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏
    "ALGORITHM": "HS256",
    "SIGNING_KEY": SECRET_KEY,
    "VERIFYING_KEY": None,
    "UPDATE_LAST_LOGIN": True,
}

INSTALLED_APPS = [
    'corsheaders',
    'channels',
    'unfold',
    'whatsapp',
    'rest_framework',
    'backend',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]

# üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–ò–ô MIDDLEWARE –ó –ö–ï–®–£–í–ê–ù–ù–Ø–ú –¢–ê –ú–û–ù–Ü–¢–û–†–ò–ù–ì–û–ú
MIDDLEWARE = [
    'django.middleware.cache.UpdateCacheMiddleware',  # üöÄ –ö–ï–®–£–í–ê–ù–ù–Ø - –Ω–∞ –ø–æ—á–∞—Ç–æ–∫
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'backend.middleware.PerformanceMiddleware',       # üöÄ –ú–û–ù–Ü–¢–û–†–ò–ù–ì –ü–†–û–î–£–ö–¢–ò–í–ù–û–°–¢–Ü
    'django.middleware.cache.FetchFromCacheMiddleware',  # üöÄ –ö–ï–®–£–í–ê–ù–ù–Ø - –≤ –∫—ñ–Ω–µ—Ü—å
]

ROOT_URLCONF = 'NashCRM.urls'

# üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–Ü –®–ê–ë–õ–û–ù–ò –ó –ö–ï–®–£–í–ê–ù–ù–Ø–ú
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
            # üöÄ –î–û–î–ê–ù–û: –ö–µ—à—É–≤–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
            'loaders': [
                ('django.template.loaders.cached.Loader', [
                    'django.template.loaders.filesystem.Loader',
                    'django.template.loaders.app_directories.Loader',
                ]),
            ] if not DEBUG else [
                'django.template.loaders.filesystem.Loader',
                'django.template.loaders.app_directories.Loader',
            ],
        },
    },
]

WSGI_APPLICATION = 'NashCRM.wsgi.application'

# üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–ê –ë–ê–ó–ê –î–ê–ù–ò–•
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
        # üöÄ –î–û–î–ê–ù–û: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è SQLite
        'OPTIONS': {
            'timeout': 20,
            'init_command': """
                PRAGMA journal_mode=WAL;
                PRAGMA synchronous=NORMAL;
                PRAGMA cache_size=1000;
                PRAGMA temp_store=memory;
                PRAGMA foreign_keys=ON;
            """,
        },
    }
}

# üöÄ –ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û: –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ö–ï–®–£–í–ê–ù–ù–Ø
CACHES = {
    'default': {
        # –°–ø—Ä–æ–±—É–π—Ç–µ Redis —Å–ø–æ—á–∞—Ç–∫—É (–Ω–∞–π–∫—Ä–∞—â–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å)
        'BACKEND': 'django.core.cache.backends.redis.RedisCache',
        'LOCATION': 'redis://127.0.0.1:6379/1',
        'KEY_PREFIX': 'nashcrm_cache',
        'TIMEOUT': 300,  # 5 —Ö–≤–∏–ª–∏–Ω –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
            'CONNECTION_POOL_KWARGS': {
                'max_connections': 50,
                'retry_on_timeout': True,
            },
            'SERIALIZER': 'django_redis.serializers.json.JSONSerializer',
            'COMPRESSOR': 'django_redis.compressors.zlib.ZlibCompressor',
        }
    } if os.environ.get('REDIS_URL') or os.path.exists('/usr/bin/redis-server') else {
        # Fallback –¥–æ database cache —è–∫—â–æ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π
        'BACKEND': 'django.core.cache.backends.db.DatabaseCache',
        'LOCATION': 'cache_table',
        'TIMEOUT': 300,
        'OPTIONS': {
            'MAX_ENTRIES': 10000,
            'CULL_FREQUENCY': 3,
        }
    }
}

# üöÄ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –°–ï–°–Ü–ô –ó –ö–ï–®–£–í–ê–ù–ù–Ø–ú
SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
SESSION_CACHE_ALIAS = 'default'
SESSION_COOKIE_AGE = 86400  # 24 –≥–æ–¥–∏–Ω–∏

# üöÄ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ö–ï–®–£–í–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–û–ö
CACHE_MIDDLEWARE_ALIAS = 'default'
CACHE_MIDDLEWARE_SECONDS = 300  # 5 —Ö–≤–∏–ª–∏–Ω
CACHE_MIDDLEWARE_KEY_PREFIX = 'nashcrm'

# Password validation
AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]

# Internationalization
LANGUAGE_CODE = 'uk'
TIME_ZONE = 'Europe/Kyiv'
USE_I18N = True
USE_L10N = True
USE_TZ = True

# üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–Ü –°–¢–ê–¢–ò–ß–ù–Ü –§–ê–ô–õ–ò
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
STATICFILES_DIRS = [
    BASE_DIR / "static",
]

# üöÄ –î–û–î–ê–ù–û: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
if not DEBUG:
    STATICFILES_STORAGE = 'django.contrib.staticfiles.storage.ManifestStaticFilesStorage'

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# üöÄ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –õ–û–ì–£–í–ê–ù–ù–Ø –î–õ–Ø –ú–û–ù–Ü–¢–û–†–ò–ù–ì–£ –ü–†–û–î–£–ö–¢–ò–í–ù–û–°–¢–Ü
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {process:d} {thread:d} {message}',
            'style': '{',
        },
        'simple': {
            'format': '{levelname} {message}',
            'style': '{',
        },
        'performance': {
            'format': '[{asctime}] {levelname} {message}',
            'style': '{',
        },
    },
    'handlers': {
        'file': {
            'level': 'DEBUG' if DEBUG else 'WARNING',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': BASE_DIR / 'logs' / 'slow_queries.log',
            'maxBytes': 50 * 1024 * 1024,  # 50MB
            'backupCount': 5,
            'formatter': 'verbose',
        },
        'console': {
            'level': 'INFO',
            'class': 'logging.StreamHandler',
            'formatter': 'performance',
        },
        'performance_file': {
            'level': 'INFO',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': BASE_DIR / 'logs' / 'performance.log',
            'maxBytes': 10 * 1024 * 1024,  # 10MB
            'backupCount': 3,
            'formatter': 'performance',
        },
    },
    'loggers': {
        'django.db.backends': {
            'level': 'DEBUG' if DEBUG else 'WARNING',
            'handlers': ['file'],
            'propagate': False,
        },
        'nashcrm.performance': {
            'level': 'INFO',
            'handlers': ['console', 'performance_file'],
            'propagate': False,
        },
        'django.request': {
            'level': 'ERROR',
            'handlers': ['file'],
            'propagate': False,
        },
    },
}

# üöÄ –°–¢–í–û–†–ï–ù–ù–Ø –ü–ê–ü–ö–ò –î–õ–Ø –õ–û–ì–Ü–í
os.makedirs(BASE_DIR / 'logs', exist_ok=True)

# üöÄ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ë–ï–ó–ü–ï–ö–ò
if not DEBUG:
    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
    SECURE_CONTENT_TYPE_NOSNIFF = True
    SECURE_BROWSER_XSS_FILTER = True
    X_FRAME_OPTIONS = 'DENY'
    SECURE_HSTS_SECONDS = 31536000  # 1 —Ä—ñ–∫
    SECURE_HSTS_INCLUDE_SUBDOMAINS = True
    SECURE_HSTS_PRELOAD = True

    # –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ HTTPS
    # SECURE_SSL_REDIRECT = True
    # SESSION_COOKIE_SECURE = True
    # CSRF_COOKIE_SECURE = True

# UNFOLD Admin –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–±–µ–∑ –∑–º—ñ–Ω, –∞–ª–µ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ)
def dashboard_callback(request, context):
    context.update({"sample": "example"})
    return context

def environment_callback(request):
    return

def badge_callback(request):
    return 3

def permission_callback(request):
    return request.user.has_perm("sample_app.change_model")

UNFOLD = {
    "SITE_TITLE": "NashCRM - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ª—ñ–¥–∞–º–∏",
    "SITE_HEADER": "NashCRM",
    "SITE_SUBHEADER": "–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ–¥–∞–∂–∞–º–∏",
    "SITE_URL": "/",
    "SITE_ICON": {
        "light": lambda request: static("backend/img/crm.png"),
        "dark": lambda request: static("backend/img/crm.png"),
    },
    "SITE_LOGO": {
        "light": lambda request: static("backend/img/crm.png"),
        "dark": lambda request: static("backend/img/crm.png"),
    },
    "SITE_SYMBOL": "speed",
    "SITE_FAVICONS": [
        {
            "rel": "icon",
            "sizes": "32x32",
            "type": "image/svg+xml",
            "href": lambda request: static("favicon.svg"),
        },
    ],
    "SHOW_HISTORY": True,
    "SHOW_VIEW_ON_SITE": True,
    "SHOW_BACK_BUTTON": False,
    "ENVIRONMENT": environment_callback,
    "ENVIRONMENT_TITLE_PREFIX": environment_callback,
    "DASHBOARD_CALLBACK": dashboard_callback,
    "THEME": "dark",
    "LOGIN": {
        "image": lambda request: static("sample/login-bg.jpg"),
        "redirect_after": lambda request: reverse_lazy("admin:backend_lead_changelist"),
    },
    "STYLES": [
        lambda request: static("backend/css/style.css"),
    ],
    "SCRIPTS": [
        lambda request: static("js/script.js"),
    ],
    "BORDER_RADIUS": "6px",
    "COLORS": {
        "base": {
            "50": "249, 250, 251",
            "100": "243, 244, 246",
            "200": "229, 231, 235",
            "300": "209, 213, 219",
            "400": "156, 163, 175",
            "500": "107, 114, 128",
            "600": "75, 85, 99",
            "700": "55, 65, 81",
            "800": "31, 41, 55",
            "900": "17, 24, 39",
            "950": "3, 7, 18",
        },
        "primary": {
            "50": "250, 245, 255",
            "100": "243, 232, 255",
            "200": "233, 213, 255",
            "300": "216, 180, 254",
            "400": "192, 132, 252",
            "500": "168, 85, 247",
            "600": "147, 51, 234",
            "700": "126, 34, 206",
            "800": "107, 33, 168",
            "900": "88, 28, 135",
            "950": "59, 7, 100",
        },
        "font": {
            "subtle-light": "var(--color-base-500)",
            "subtle-dark": "var(--color-base-400)",
            "default-light": "var(--color-base-600)",
            "default-dark": "var(--color-base-300)",
            "important-light": "var(--color-base-900)",
            "important-dark": "var(--color-base-100)",
        },
    },
    "EXTENSIONS": {
        "modeltranslation": {
            "flags": {
                "en": "üá¨üáß",
                "fr": "üá´üá∑",
                "nl": "üáßüá™",
            },
        },
    },
    "SIDEBAR": {
        "show_all_applications": False,
        "navigation": [
            {
                "title": _("üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –∑–≤—ñ—Ç–∏"),
                "separator": True,
                "items": [
                    {
                        "title": "üöÄ Dashboard –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ",
                        "icon": "dashboard",
                        "link": reverse_lazy("admin:index"),
                    },
                    {
                        "title": "üìà –ó–≤—ñ—Ç –ø–æ –ª—ñ–¥–∞—Ö",
                        "icon": "bar_chart",
                        "link": reverse_lazy("admin_leads_report"),
                    },
                ],
            },
            {
                "title": _("üí∞ –ü—Ä–æ–¥–∞–∂—ñ —Ç–∞ —Ñ—ñ–Ω–∞–Ω—Å–∏"),
                "separator": True,
                "items": [
                    {
                        "title": "üéØ –õ—ñ–¥–∏",
                        "icon": "shopping_cart",
                        "link": reverse_lazy("admin:backend_lead_changelist"),
                    },
                    {
                        "title": "üí∏ –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó",
                        "icon": "payments",
                        "link": reverse_lazy("admin:backend_leadpaymentoperation_changelist"),
                    },
                    {
                        "title": "üë• –ö–ª—ñ—î–Ω—Ç–∏",
                        "icon": "person",
                        "link": reverse_lazy("admin:backend_client_changelist"),
                    },
                ],
            },
            {
                "title": _("‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"),
                "separator": True,
                "items": [
                    {
                        "title": "üìß Email —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è",
                        "icon": "email",
                        "link": reverse_lazy("admin:backend_emailintegrationsettings_changelist"),
                    },
                    {
                        "title": "üë®‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä–∏",
                        "icon": "admin_panel_settings",
                        "link": reverse_lazy("admin:backend_customuser_changelist"),
                    },
                ],
            },
        ],
    },
    "TABS": [
        {
            "models": [
                "backend.lead",
            ],
            "items": [
                {
                    "title": _("–í—Å—ñ –ª—ñ–¥–∏"),
                    "link": reverse_lazy("admin:backend_lead_changelist"),
                },
                {
                    "title": _("–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó"),
                    "link": reverse_lazy("admin:backend_leadpaymentoperation_changelist"),
                },
            ],
        },
    ],
}

# üöÄ CORS –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ó –ë–ï–ó–ü–ï–ö–û–Æ
CORS_ALLOWED_ORIGINS = [
    "https://nash-web-crm.vercel.app",
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:3001",  # –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –ø–æ—Ä—Ç –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏
]

CORS_ALLOW_CREDENTIALS = True

CORS_ALLOWED_HEADERS = [
    'accept',
    'accept-encoding',
    'authorization',
    'content-type',
    'dnt',
    'origin',
    'user-agent',
    'x-csrftoken',
    'x-requested-with',
    'cache-control',  # üöÄ –î–û–î–ê–ù–û –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è
    'x-cache-control',
]

CORS_ALLOWED_METHODS = [
    'DELETE',
    'GET',
    'OPTIONS',
    'PATCH',
    'POST',
    'PUT',
]

# üöÄ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ë–ï–ó–ü–ï–ö–ò
CSRF_TRUSTED_ORIGINS = [
    "https://nash-web-crm.vercel.app",
    "https://nashcrm.onrender.com",
]

# üöÄ –î–û–î–ê–¢–ö–û–í–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –î–õ–Ø –ü–†–û–î–£–ö–¢–ò–í–ù–û–°–¢–Ü

# –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
FILE_UPLOAD_MAX_MEMORY_SIZE = 5 * 1024 * 1024  # 5MB
DATA_UPLOAD_MAX_MEMORY_SIZE = 10 * 1024 * 1024  # 10MB

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è email (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ)
if not DEBUG:
    EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
    EMAIL_USE_TLS = True
    EMAIL_PORT = 587
    # EMAIL_HOST = 'your-smtp-server.com'
    # EMAIL_HOST_USER = 'your-email@domain.com'
    # EMAIL_HOST_PASSWORD = 'your-password'

# üöÄ –ö–ê–°–¢–û–ú–ù–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –î–õ–Ø CRM
CRM_SETTINGS = {
    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö
    'CACHE_TIMEOUTS': {
        'leads_report': 600,  # 10 —Ö–≤–∏–ª–∏–Ω
        'funnel_data': 300,   # 5 —Ö–≤–∏–ª–∏–Ω
        'client_stats': 300,  # 5 —Ö–≤–∏–ª–∏–Ω
        'manager_stats': 900, # 15 —Ö–≤–∏–ª–∏–Ω
        'geocoding': 86400,   # 24 –≥–æ–¥–∏–Ω–∏
    },

    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–ø–∏—Å–∫—ñ–≤
    'PAGINATION': {
        'leads': 50,
        'clients': 30,
        'payments': 100,
        'reports': 20,
    },

    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
    'PERFORMANCE': {
        'SLOW_QUERY_THRESHOLD': 1.0,  # —Å–µ–∫—É–Ω–¥–∏
        'MANY_QUERIES_THRESHOLD': 10,  # –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤
        'LOG_ALL_REQUESTS': DEBUG,
    },

    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏
    'BUSINESS': {
        'DEFAULT_LEAD_STATUS': 'new',
        'MAX_PAYMENT_AMOUNT': 1000000,  # 1 –º—ñ–ª—å–π–æ–Ω
        'CURRENCY': 'UAH',
        'AUTO_ASSIGN_LEADS': True,
    }
}

# üöÄ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –î–õ–Ø –†–Ü–ó–ù–ò–• –°–ï–†–ï–î–û–í–ò–©
if os.environ.get('ENVIRONMENT') == 'production':
    DEBUG = False

    # –î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
    USE_TZ = True

    # –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
    if 'postgresql' in DATABASES['default']['ENGINE']:
        DATABASES['default']['OPTIONS'] = {
            'options': '-c default_transaction_isolation=read_committed'
        }
        DATABASES['default']['CONN_MAX_AGE'] = 600

# üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –°–¢–í–û–†–ï–ù–ù–Ø –¢–ê–ë–õ–ò–¶–Ü –ö–ï–®–£–í–ê–ù–ù–Ø (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è database cache)
if CACHES['default']['BACKEND'] == 'django.core.cache.backends.db.DatabaseCache':
    import django
    from django.core.management import execute_from_command_line

    try:
        execute_from_command_line(['manage.py', 'createcachetable', '--dry-run'])
    except:
        pass  # –¢–∞–±–ª–∏—Ü—è –≤–∂–µ —ñ—Å–Ω—É—î –∞–±–æ –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –ø—ñ–∑–Ω—ñ—à–µ

print("üöÄ NashCRM –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!")
if DEBUG:
    print("‚ö° –†–µ–∂–∏–º —Ä–æ–∑—Ä–æ–±–∫–∏: –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —É–≤—ñ–º–∫–Ω–µ–Ω–æ")
else:
    print("üîí –†–µ–∂–∏–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É: –±–µ–∑–ø–µ–∫–∞ —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —É–≤—ñ–º–∫–Ω–µ–Ω–æ")